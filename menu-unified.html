<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>Menu IGM</title>
    <!-- Removed all external CDNs for offline support -->
    <style>
        :root {
            --menu-primary: #EDF2F4;
            --menu-font-primary: #5D9CC4;
            --menu-secondary: #5D9CC4;
            --menu-font-secondary: #fff;
            --menu-disabled: #EDF2F4;
            --menu-font-disabled: #7F7F7F;
            --submenu-primary: #e4e5e5;
            --submenu-font-primary: #5f788f;
            --submenu-secondary: #5D9CC4;
            --submenu-font-secondary: #ffffff;
        }

        body {
            font-size: 12px;
            letter-spacing: -0.01em;
            /* Using system font stack to mimic Nunito Sans offline */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow-y: hidden;
        }

        .active {
            background-color: var(--menu-secondary);
            color: var(--menu-font-secondary) !important;
        }

        .disabled {
            background-color: var(--menu-disabled);
            color: var(--menu-font-disabled) !important;
        }

        .navbar {
            overflow: hidden;
            background-color: var(--menu-primary);
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            height: 80px;
            grid-gap: 1px;
            justify-content: start;
            align-content: space-evenly;
            -webkit-transition: width 200ms ease-in-out, height 200ms ease-in-out;
        }

        .submenubar {
            overflow: hidden;
            background-color: #f9f9f9;
        }

        .navbar a {
            float: left;
            color: var(--menu-font-primary);
            text-align: center;
            padding: 9px 1px;
            text-decoration: none;
            cursor: pointer;
        }

        .submenubar a {
            float: left;
            color: white;
            text-align: center;
            padding: 12px 16px;
            text-decoration: none;
        }

        .navbar a:hover {
            background-color: var(--menu-secondary);
            color: var(--menu-font-secondary);
            cursor: pointer;
        }

        .hover-disabled:hover {
            background-color: var(--menu-disabled) !important;
        }

        .dropdown-content {
            display: none;
            background-color: var(--submenu-font-primary);
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            width: 100%;
        }

        .dropdown-content a {
            color: var(--submenu-font-primary);
            padding: 8px 8px;
            text-decoration: none;
            display: inline-block;
            text-align: left;
        }

        .dropdown-content p {
            padding-left: 0.5em;
        }

        .dropdown-content a:hover {
            background-color: var(--submenu-secondary);
            color: var(--submenu-font-secondary);
            cursor: pointer
        }

        .hcuarentayuno {
            height: 45px;
        }

        .grp a {
            display: grid;
        }

        /* SVG and Icon styling matching the original font-icon feel */
        .grp svg,
        .grp i {
            transition: all .2s;
            margin: 0 auto;
            fill: currentColor;
            display: block;
        }

        p {
            margin: 0;
            line-height: 0.9em;
        }

        .submenu-icon {
            vertical-align: middle;
            width: 1em;
            height: 1em;
            display: inline-block !important;
            /* margin-left: 2px; */
        }

        /* Prevent text selection */
        * {
            user-select: none;
            -webkit-user-select: none;
        }
    </style>
</head>

<body>
    <div id='grp' class='grp'>
        <div id='img' class='navbar'>
        </div>
    </div>
    <div id='submenubar' class='submenubar'>
    </div>

    <script>
        var json_menu = __JSON_MENU__;

        window.onload = function () {
            renderMenu();
            active('__LAYOUT_CODE__');
        };

        function renderMenu() {
            let menu_html = ''
            let submenu_html = ''
            let count = 0;

            if (!json_menu || !Array.isArray(json_menu)) return;

            const arrowIcon = `<svg class="submenu-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.5L6 9.5L7.41 8.09L12 12.67L16.59 8.09L18 9.5L12 15.5Z"></path></svg>`;

            json_menu.forEach(e => {
                let iconContent = e.icon;
                if (!iconContent || !iconContent.trim().startsWith('<svg')) {
                    iconContent = `<i class="${e.icon || ''} icon-main"></i>`;
                } else {
                    // Wrap SVG and ensure it has the icon-main class for selection
                    iconContent = iconContent.replace('<svg ', '<svg class="icon-main" ');
                }

                const nameClean = eliminarTildes(e.nombre);

                if (e.submenu && e.submenu.length > 0) {
                    if (e.disabled) {
                        menu_html += `<a class='disabled hover-disabled' name="${nameClean}" layout="${e.layoutCode}">${iconContent}<p>${e.nombre}</p></a>`
                    } else {
                        menu_html += `<a id="menu-submenu${count}" onclick="submenu(${count})" name="${nameClean}" layout="${e.layoutCode}">${iconContent}<p>${e.nombre}${arrowIcon}</p></a>`
                    }

                    let sub_a = ''
                    e.submenu.forEach(a => {
                        let i = (a.fe === void 0) ? a.layoutCode : a.layoutCode + "|" + a.fe;

                        let subIcon = a.icon;
                        if (!subIcon || !subIcon.trim().startsWith('<svg')) {
                            subIcon = `<i style="vertical-align: middle;" class='${a.icon || ''}'></i>`;
                        } else {
                            subIcon = subIcon.replace('<svg ', '<svg style="width: 1.2em; height: 1.2em; vertical-align: middle;" ');
                        }

                        if (a.disabled) {
                            sub_a += `<a class='disabled hover-disabled'>${subIcon}<p style="display: inline;">${a.nombre}</p></a>`
                        } else {
                            sub_a += `<a onclick="goToLayout('${i}')">${subIcon}<p style="display: inline;">${a.nombre}</p></a>`
                        }
                    });
                    submenu_html += `<div id='submenu${count}' class='dropdown-content'>${sub_a}</div>`
                    count++
                } else {
                    if (e.disabled) {
                        menu_html += `<a class='disabled hover-disabled' name="${nameClean}" layout="${e.layoutCode}">${iconContent}<p>${e.nombre}</p></a>`
                    } else {
                        menu_html += `<a onclick="goToLayout('${e.layoutCode}')" name="${nameClean}" layout="${e.layoutCode}">${iconContent}<p>${e.nombre}</p></a>`
                    }
                }
            });

            document.getElementById('img').innerHTML = menu_html;
            document.getElementById('submenubar').innerHTML = submenu_html;

            updateIconSize(false);
        }

        function updateIconSize(isSmall) {
            const mainIcons = document.querySelectorAll('.icon-main');
            const mainSize = isSmall ? '1.2em' : '3.5em'; // Using 3.5em to avoid overcrowding observed in 4em SVGs

            mainIcons.forEach(el => {
                if (el.tagName.toLowerCase() === 'svg') {
                    el.style.width = mainSize;
                    el.style.height = mainSize;
                } else {
                    el.style.fontSize = mainSize;
                }
            });

            const arrows = document.querySelectorAll('.submenu-icon');
            arrows.forEach(el => {
                el.style.fontSize = isSmall ? '1.2em' : '1.4em';
            });
        }

        function submenu(a) {
            var elms = document.querySelectorAll('div[style*="display: block"]');
            var drop = document.getElementById('submenu' + a);
            var navbar = document.getElementById('img');
            var nava = document.getElementById('img');

            if (elms.length > 0) {
                var sid = elms[0].id;
                if (sid == 'submenu' + a) {
                    elms[0].style.display = 'none';
                    navbar.classList.remove('hcuarentayuno');
                    nava.childNodes.forEach(element => {
                        if (element.style) element.style.padding = '9px 1px';
                    });
                    updateIconSize(false);
                } else {
                    // Close other and open this
                    elms[0].style.display = 'none';
                    drop.style.display = 'block';
                }
            } else {
                navbar.classList.add('hcuarentayuno');
                drop.style.display = 'block';
                nava.childNodes.forEach(element => {
                    if (element.style) element.style.padding = '4px 1px';
                });
                updateIconSize(true);
            }
        }

        function goToLayout(code) {
            if (window.FileMaker) {
                FileMaker.PerformScript('pruebaMenuJS', code);
            } else {
                console.log("Go to layout:", code);
            }
        }

        function active(layoutCode) {
            document.querySelectorAll('.navbar a').forEach(el => el.classList.remove('active'));
            if (!json_menu) return;
            const match = json_menu.find(m => m.activo && m.activo.includes(layoutCode));
            if (match) {
                const el = document.getElementsByName(eliminarTildes(match.nombre))[0];
                if (el) el.classList.add('active');
            }
        }

        function eliminarTildes(texto) {
            if (!texto) return "";
            return texto.normalize('NFD').replace(/[\u0300-\u036f]/g, "");
        }

        window.addEventListener('wheel', function (e) {
            if (e.ctrlKey) e.preventDefault();
        }, { passive: false });

        window.addEventListener('keydown', function (e) {
            if (e.ctrlKey && (e.key === '+' || e.key === '-' || e.key === '0' || e.key === '=')) {
                e.preventDefault();
            }
        });
    </script>
</body>

</html>